# Variables d'Environnement Render pour Flowise

Ce document d√©taille toutes les variables d'environnement n√©cessaires pour d√©ployer Flowise sur Render.

## üîß Variables Obligatoires

### Configuration de Base

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `NODE_ENV` | Environnement d'ex√©cution | `production` | `production` |
| `PORT` | Port d'√©coute (fixe sur Render) | `10000` | `10000` |
| `APP_URL` | URL de votre application | `https://your-app.onrender.com` | `https://flowise-ai.onrender.com` |

### Base de Donn√©es

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `DATABASE_TYPE` | Type de base de donn√©es | `sqlite` | `sqlite` |
| `DATABASE_PATH` | Chemin vers la base SQLite | `/opt/render/project/src/database.sqlite` | `/opt/render/project/src/database.sqlite` |

### S√©curit√© (G√©n√©r√©es Automatiquement)

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `FLOWISE_SECRETKEY_OVERWRITE` | Cl√© secr√®te principale | `generateValue: true` | `a1b2c3d4e5f6...` |
| `JWT_AUTH_TOKEN_SECRET` | Secret pour les tokens JWT | `generateValue: true` | `jwt_secret_32_chars` |
| `JWT_REFRESH_TOKEN_SECRET` | Secret pour les refresh tokens | `generateValue: true` | `refresh_secret_32_chars` |
| `EXPRESS_SESSION_SECRET` | Secret pour les sessions Express | `generateValue: true` | `session_secret_32_chars` |
| `TOKEN_HASH_SECRET` | Secret pour le hachage des tokens | `generateValue: true` | `token_hash_secret` |

## üîß Variables Recommand√©es

### Stockage et Logs

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `STORAGE_TYPE` | Type de stockage | `local` | `local` |
| `BLOB_STORAGE_PATH` | Chemin de stockage des fichiers | `/opt/render/project/src/uploads` | `/opt/render/project/src/uploads` |
| `LOG_LEVEL` | Niveau de logging | `info` | `info`, `debug`, `warn`, `error` |
| `LOG_PATH` | Chemin des fichiers de log | `/opt/render/project/src/logs` | `/opt/render/project/src/logs` |

### Configuration CORS et S√©curit√©

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `CORS_ORIGINS` | Origines autoris√©es pour CORS | `https://your-app.onrender.com` | `https://flowise-ai.onrender.com` |
| `DISABLE_FLOWISE_TELEMETRY` | D√©sactiver la t√©l√©m√©trie | `true` | `true` |
| `FLOWISE_FILE_SIZE_LIMIT` | Taille max des fichiers (MB) | `10` | `10` |

### Configuration Node.js

| Variable | Description | Valeur Render | Exemple |
|----------|-------------|---------------|---------|
| `NODE_OPTIONS` | Options Node.js | `--max-old-space-size=512` | `--max-old-space-size=512` |

## üîß Variables Optionnelles

### Configuration JWT

| Variable | Description | Valeur par d√©faut | Exemple |
|----------|-------------|-------------------|---------|
| `JWT_ISSUER` | √âmetteur des tokens JWT | `flowise` | `your-app.onrender.com` |
| `JWT_AUDIENCE` | Audience des tokens JWT | `flowise` | `your-app.onrender.com` |
| `JWT_TOKEN_EXPIRY_IN_MINUTES` | Dur√©e de vie des tokens (minutes) | `60` | `120` |
| `JWT_REFRESH_TOKEN_EXPIRY_IN_MINUTES` | Dur√©e de vie des refresh tokens (minutes) | `10080` | `20160` |
| `EXPIRE_AUTH_TOKENS_ON_RESTART` | Expirer les tokens au red√©marrage | `false` | `true` |
| `PASSWORD_SALT_HASH_ROUNDS` | Nombre de rounds pour le hachage | `10` | `12` |

### Configuration des N≈ìuds

| Variable | Description | Valeur par d√©faut | Exemple |
|----------|-------------|-------------------|---------|
| `SHOW_COMMUNITY_NODES` | Afficher les n≈ìuds communautaires | `true` | `false` |
| `DISABLED_NODES` | N≈ìuds d√©sactiv√©s (s√©par√©s par virgule) | - | `OpenAI,Anthropic` |
| `MODEL_LIST_CONFIG_JSON` | Configuration des mod√®les (JSON) | - | `{"openai":["gpt-4","gpt-3.5-turbo"]}` |

### Configuration Email (SMTP)

| Variable | Description | Exemple |
|----------|-------------|---------|
| `SMTP_HOST` | Serveur SMTP | `smtp.gmail.com` |
| `SMTP_PORT` | Port SMTP | `587` |
| `SMTP_USER` | Utilisateur SMTP | `votre-email@gmail.com` |
| `SMTP_PASSWORD` | Mot de passe SMTP | `votre_mot_de_passe_app` |
| `SMTP_SECURE` | Utiliser SSL/TLS | `true` |
| `ALLOW_UNAUTHORIZED_CERTS` | Autoriser les certificats non autoris√©s | `false` |
| `SENDER_EMAIL` | Email exp√©diteur | `noreply@your-app.onrender.com` |

### Configuration Proxy

| Variable | Description | Exemple |
|----------|-------------|---------|
| `GLOBAL_AGENT_HTTP_PROXY` | Proxy HTTP | `http://proxy.example.com:8080` |
| `GLOBAL_AGENT_HTTPS_PROXY` | Proxy HTTPS | `https://proxy.example.com:8080` |
| `GLOBAL_AGENT_NO_PROXY` | Exclusions proxy | `localhost,127.0.0.1` |

### Configuration Queue (Redis)

| Variable | Description | Valeur par d√©faut | Exemple |
|----------|-------------|-------------------|---------|
| `MODE` | Mode d'ex√©cution | `main` | `main`, `worker` |
| `QUEUE_NAME` | Nom de la queue | `flowise` | `flowise-prod` |
| `REDIS_URL` | URL Redis compl√®te | - | `redis://localhost:6379` |
| `REDIS_HOST` | H√¥te Redis | `localhost` | `redis.example.com` |
| `REDIS_PORT` | Port Redis | `6379` | `6379` |
| `REDIS_USERNAME` | Utilisateur Redis | - | `redis_user` |
| `REDIS_PASSWORD` | Mot de passe Redis | - | `redis_password` |
| `REDIS_TLS` | Utiliser TLS pour Redis | `false` | `true` |
| `WORKER_CONCURRENCY` | Nombre de workers | `1` | `4` |

### Configuration des M√©triques

| Variable | Description | Valeur par d√©faut | Exemple |
|----------|-------------|-------------------|---------|
| `ENABLE_METRICS` | Activer les m√©triques | `false` | `true` |
| `METRICS_PROVIDER` | Fournisseur de m√©triques | `prometheus` | `prometheus`, `datadog` |
| `METRICS_SERVICE_NAME` | Nom du service pour les m√©triques | `flowise` | `flowise-prod` |
| `METRICS_INCLUDE_NODE_METRICS` | Inclure les m√©triques des n≈ìuds | `false` | `true` |
| `METRICS_OPEN_TELEMETRY_METRIC_ENDPOINT` | Endpoint OpenTelemetry | - | `https://api.datadoghq.com/api/v1/series` |
| `METRICS_OPEN_TELEMETRY_PROTOCOL` | Protocole OpenTelemetry | `http/protobuf` | `http/json` |
| `METRICS_OPEN_TELEMETRY_DEBUG` | Debug OpenTelemetry | `false` | `true` |

## üìù Configuration render.yaml

### Exemple Complet

```yaml
services:
  - type: web
    name: flowise
    env: node
    region: oregon
    plan: free
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /api/v1/ping
    envVars:
      # Configuration de base
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      
      # Base de donn√©es
      - key: DATABASE_TYPE
        value: sqlite
      - key: DATABASE_PATH
        value: /opt/render/project/src/database.sqlite
      
      # S√©curit√© (g√©n√©r√©es automatiquement)
      - key: FLOWISE_SECRETKEY_OVERWRITE
        generateValue: true
      - key: JWT_AUTH_TOKEN_SECRET
        generateValue: true
      - key: JWT_REFRESH_TOKEN_SECRET
        generateValue: true
      - key: EXPRESS_SESSION_SECRET
        generateValue: true
      - key: TOKEN_HASH_SECRET
        generateValue: true
      
      # Configuration de l'application
      - key: APP_URL
        value: https://flowise.onrender.com
      - key: STORAGE_TYPE
        value: local
      - key: BLOB_STORAGE_PATH
        value: /opt/render/project/src/uploads
      
      # Logging
      - key: LOG_LEVEL
        value: info
      - key: LOG_PATH
        value: /opt/render/project/src/logs
      
      # CORS et s√©curit√©
      - key: CORS_ORIGINS
        value: https://flowise.onrender.com
      - key: DISABLE_FLOWISE_TELEMETRY
        value: true
      
      # Limites
      - key: FLOWISE_FILE_SIZE_LIMIT
        value: 10
      
      # Configuration Node.js
      - key: NODE_OPTIONS
        value: --max-old-space-size=512
```

## üîê G√©n√©ration de Cl√©s Secr√®tes

### Script de G√©n√©ration

```bash
#!/bin/bash
# G√©n√©rer des cl√©s secr√®tes pour Render

echo "=== Cl√©s secr√®tes pour Flowise sur Render ==="
echo ""
echo "FLOWISE_SECRETKEY_OVERWRITE=$(openssl rand -hex 32)"
echo "JWT_AUTH_TOKEN_SECRET=$(openssl rand -hex 32)"
echo "JWT_REFRESH_TOKEN_SECRET=$(openssl rand -hex 32)"
echo "EXPRESS_SESSION_SECRET=$(openssl rand -hex 32)"
echo "TOKEN_HASH_SECRET=$(openssl rand -hex 32)"
echo ""
echo "=== Copiez ces valeurs dans Render Dashboard ==="
```

### G√©n√©ration Manuelle

```bash
# Cl√© secr√®te principale
openssl rand -hex 32

# Secret JWT
openssl rand -base64 32

# Secret de session
openssl rand -base64 32
```

## ‚ö†Ô∏è Limitations Render

### Plan Gratuit

- **M√©moire** : 512MB RAM
- **CPU** : 0.1 CPU
- **Stockage** : √âph√©m√®re (perdu au red√©marrage)
- **Mise en veille** : Apr√®s 15 minutes d'inactivit√©
- **Bande passante** : 100GB/mois

### Recommandations

1. **Utilisez SQLite** pour la base de donn√©es (stockage local)
2. **Limitez la taille des fichiers** upload√©s
3. **Configurez des sauvegardes** r√©guli√®res
4. **Utilisez un service de ping** pour √©viter la mise en veille

## üîÑ Sauvegarde des Donn√©es

### Script de Sauvegarde

```bash
#!/bin/bash
# Sauvegarder les donn√©es Flowise sur Render

# Variables
APP_NAME="your-app-name"
BACKUP_DIR="./backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Cr√©er le dossier de sauvegarde
mkdir -p $BACKUP_DIR

# Sauvegarder la base de donn√©es
curl -o "$BACKUP_DIR/database_$DATE.sqlite" \
  "https://$APP_NAME.onrender.com/api/v1/backup/database"

# Sauvegarder les fichiers upload√©s
curl -o "$BACKUP_DIR/uploads_$DATE.tar.gz" \
  "https://$APP_NAME.onrender.com/api/v1/backup/uploads"

echo "Sauvegarde termin√©e : $BACKUP_DIR/"
```

## üÜò D√©pannage

### Probl√®mes Courants

1. **Build √©choue** :
   - V√©rifiez les logs de build dans Render Dashboard
   - Assurez-vous que `package.json` est correct
   - V√©rifiez la version Node.js

2. **Application ne d√©marre pas** :
   - V√©rifiez les logs de d√©marrage
   - Assurez-vous que le port est `10000`
   - V√©rifiez les variables d'environnement

3. **Mise en veille fr√©quente** :
   - C'est normal avec le plan gratuit
   - Utilisez un service de ping pour maintenir l'app active

4. **Erreur de m√©moire** :
   - R√©duisez `NODE_OPTIONS` √† `--max-old-space-size=256`
   - Optimisez votre application

### Service de Ping (Optionnel)

```javascript
// Ping automatique pour √©viter la mise en veille
setInterval(() => {
  fetch('https://your-app.onrender.com/api/v1/ping')
    .catch(console.error);
}, 14 * 60 * 1000); // Toutes les 14 minutes
```

## üìà Mise √† Niveau

### Plan Payant

Si vous avez besoin de plus de ressources :

- **Starter** : $7/mois - Pas de mise en veille
- **Standard** : $25/mois - Plus de ressources
- **Pro** : $85/mois - Haute disponibilit√©

### Migration

1. **Sauvegardez vos donn√©es** avant la mise √† niveau
2. **Mettez √† niveau** dans Render Dashboard
3. **Red√©ployez** si n√©cessaire
4. **Testez** toutes les fonctionnalit√©s

---

## üìö Ressources

- **Documentation Render** : [render.com/docs](https://render.com/docs)
- **Documentation Flowise** : [docs.flowiseai.com](https://docs.flowiseai.com/)
- **Support Render** : [render.com/support](https://render.com/support)
